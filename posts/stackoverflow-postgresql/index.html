<!DOCTYPE html>
<html lang="en">
	<head>
		
  		
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7Z74BTZ0TM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7Z74BTZ0TM');
</script>
  		
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Load StackOverflow&rsquo;s StackExchange data in Postgresql¬Æ</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://ftisiot.net/index.xml">
		<link rel="canonical" href="https://ftisiot.net/posts/stackoverflow-postgresql/">
		
		<link rel="shortcut icon" type="image/png" href="https://ftisiot.net/apple-touch-icon-precomposed.png">
		<meta name="description" content="How to load StackOverflow StackExchange data in PostgreSQL">
		
		

		
		<meta property="og:title" content="Load StackOverflow&rsquo;s StackExchange data in Postgresql¬Æ" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://ftisiot.net/images/2024/stackoverflow_codegrey.png" />
		<meta property="og:description" content="How to load StackOverflow StackExchange data in PostgreSQL" />
		<meta property="og:url" content="https://ftisiot.net/posts/stackoverflow-postgresql/" />
		<meta property="og:site_name" content="Load StackOverflow&rsquo;s StackExchange data in Postgresql¬Æ" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://ftisiot.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://ftisiot.net/css/story.css" />
		<link rel="stylesheet" href="https://ftisiot.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://ftisiot.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-posts page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://ftisiot.net/images/2024/stackoverflow_codegrey.png'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://ftisiot.net" title="Home">
						<img src="https://ftisiot.net/img/logo.jpg" class="w2 h2 br-100" alt="ftisiot ideas about food and life" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="/who">who</a>
						<a class="link f5 ml2 dim near-white" href="/speaking-activities">talks</a>
						<a class="link f5 ml2 dim near-white" href="/suggestions-verona">suggestions</a>
						<a class="link f5 ml2 dim near-white" href="/postgresqljson/main">json-pg</a>
						<a class="link f5 ml2 dim near-white" href="/mysqljson/main">json-mysql</a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/channel/UCTJ4oA3-T3RdmM2OJ7d8cJg"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/ftisiot/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/ftisiot/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/francescotisiot/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://ftisiot.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://ftisiot.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Load StackOverflow&rsquo;s StackExchange data in Postgresql¬Æ</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2024-01-29T14:38:05&#43;01:00">Jan 29, 2024</time>
								<span class="display-print">by ftisiot</span>
								 in <a href="https://ftisiot.net/categories/postgresql" class="no-underline category near-white dim">PostgreSQL</a>, <a href="https://ftisiot.net/categories/stackoverflow" class="no-underline category near-white dim">StackOverflow</a>, <a href="https://ftisiot.net/categories/stackexchange" class="no-underline category near-white dim">StackExchange</a>, <a href="https://ftisiot.net/categories/dataload" class="no-underline category near-white dim">DataLoad</a>
								<span class="display-print">at https://ftisiot.net/posts/stackoverflow-postgresql/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="@ftisiot" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<p>How to load StackOverflow StackExchange data in a PostgreSQL¬Æ database!</p>
<p>I recently found about the StackOverflow dataset in <a href="https://www.kaggle.com/datasets/stackoverflow/stackoverflow">Kaggle</a>, which points to the <a href="https://archive.org/download/stackexchange">StackExchange</a> link to download the entire data. In this blog I&rsquo;ll show a (maybe not 100% polished) way to upload the data to several tables in a PostgreSQL database!</p>
<p><img src="/images/2024/stackOverFlowPostgreSQL.gif" alt="Architecture of the data loading phase"></p>
<blockquote>
<p>The data is provided by the <a href="https://archive.org/details/stackexchange">Stack Exchange Network</a></p>
</blockquote>

<p>¬†<p style="background: #C1E1C1;border: 2px solid #b4d3b2;border-radius: 15px;text-align: center;">üëâ Need a FREE PostgreSQL database?üëà<br>ü¶Ä Check <a href="https://go.aiven.io/francesco-signup">Aiven&rsquo;s FREE plans</a>! ü¶Ä </p></p>
<p style="background: #C1E1C1;border: 2px solid #b4d3b2;border-radius: 15px;text-align: center;">
‚ö°Ô∏è Need to optimize your SQL query with AI? ‚ö°Ô∏è <br>
üêß Check  <a href="https://www.eversql.com/?utm_medium=organic&utm_source=ext_blog&utm_content=ftisiotwebsite">EverSQL</a>! üêß
</p>

<h2 id="create-a-postgresql-database">Create a PostgreSQL database</h2>
<p>You can create one with <a href="https://go.aiven.io/francesco-signup">Aiven</a> or just have one local, the below code works in both examples.</p>
<h2 id="create-database-tables">Create database tables</h2>
<p>Every downloaded file, referring to a specific site, contains the following files:</p>
<ul>
<li><code>Posts</code></li>
<li><code>Users</code></li>
<li><code>Votes</code></li>
<li><code>Comments</code></li>
<li><code>PostHistory</code></li>
<li><code>PostLinks</code></li>
</ul>
<p>The detailed schema information is available in this <a href="https://meta.stackexchange.com/questions/2677/database-schema-documentation-for-the-public-data-dump-and-sede/2678#2678">meta post</a>.</p>
<p>We&rsquo;ll load the data in a two step approach:</p>
<ul>
<li>First load the XML files in a temporary table</li>
<li>Then load the data from the temporary table into the proper tables with optimised column types</li>
</ul>
<p><img src="/images/2024/stackoverflow-loading.png" alt="Architecture of the data loading phase"></p>
<p>To load the data we need the following data structures:</p>
<ul>
<li>a table <code>data_load</code> containing a unique <code>data</code> <code>TEXT</code> column we&rsquo;ll use to load the XML data row by row</li>
<li>a set of tables matching the file structures in <code>Posts</code>, <code>Users</code>, <code>Votes</code>, <code>Comments</code>, <code>PostHistory</code>, <code>PostLinks</code></li>
</ul>
<p>We can create the <code>data_load</code> table with:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">data</span><span style="color:#bbb"> </span><span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span></code></pre></div><p>The <code>data_load</code> table will be used to load the XML files on the database and then parse them accordingly.</p>
<p>The following tables are needed to properly store the data in the database.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>users(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>id<span style="color:#bbb"> </span><span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">PRIMARY</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">KEY</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>reputation<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>CreationDate<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>DisplayName<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>LastAccessDate<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">timestamp</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Location</span><span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AboutMe<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>views<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>UpVotes<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>DownVotes<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AccountId<span style="color:#bbb"> </span><span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>posts<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>id<span style="color:#bbb"> </span><span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">PRIMARY</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">KEY</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>PostTypeId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>CreationDate<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">timestamp</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>score<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>viewcount<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>body<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>OwnerUserId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>LastActivityDate<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Title<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Tags<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AnswerCount<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>CommentCount<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ContentLicense<span style="color:#bbb"> </span><span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>badges<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>id<span style="color:#bbb"> </span><span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">PRIMARY</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">KEY</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>userId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Name<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>dt<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">timestamp</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">class</span><span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>tagbased<span style="color:#bbb"> </span><span style="color:#008000">boolean</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>comments<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>id<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>postId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>score<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000">text</span><span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>creationdate<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">timestamp</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>userid<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>contentlicense<span style="color:#bbb"> </span><span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>posthistory<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>id<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>PostHistoryTypeId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>postId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>RevisionGUID<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>CreationDate<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">timestamp</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>userID<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000">text</span><span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ContentLicense<span style="color:#bbb"> </span><span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>postlinks<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>id<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>creationdate<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">timestamp</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>postId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>relatedPostId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>LinkTypeId<span style="color:#bbb"> </span><span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>tags<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>id<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>tagname<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">count</span><span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>ExcerptPostId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>WikiPostId<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>IsRequired<span style="color:#bbb"> </span><span style="color:#008000">boolean</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>IsModeratorOnly<span style="color:#bbb"> </span><span style="color:#008000">boolean</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>votes(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>id<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>postid<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>votetypeid<span style="color:#bbb"> </span><span style="color:#008000">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>creationdate<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="load-the-data">Load the data</h2>
<p>Let&rsquo;s download the <code>ai.stackexchange.com</code> the section from StackExchange dedicated to AI. Within the downloaded folder we can find 8 files (1-1 with our tables). Let&rsquo;s try to load the <code>Users.xml</code> first.</p>
<p>As mentioned before, we&rsquo;ll perform a two step loading approach:</p>
<ul>
<li>Load the XML into a table, with each XML row on a different database row</li>
<li>Parse the XML to populate the proper tables and columns</li>
</ul>
<p>The two step approach is needed since the original dataset threats all columns, including ids, as strings. We could either define all the Ids as strings or, do a bit more work to load the data into the proper column definitions.</p>
<h3 id="step-1-load-the-user-xml-into-the-data_load-table">Step 1: Load the User XML into the <code>data_load</code> table</h3>
<p><img src="/images/2024/stackoverflow-loading-step1.png" alt="Architecture of the data loading phase - step 1"></p>
<p>To load the entire XML of the <code>Users.xml</code> file into a temporary <code>data_load</code> table we can connect to the database using <code>psql</code> from the same folder where the <code>Users.xml</code> is located and execute:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="">\</span><span style="color:#008000;font-weight:bold">copy</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;tr -d &#34;\t&#34; &lt; Users.xml | sed -e &#39;&#39;s/\\/\\\\/g&#39;&#39;&#39;</span><span style="color:#bbb"> </span>HEADER<span style="color:#bbb">
</span></span></span></code></pre></div><p>The <code>\copy</code> command allows us to load the dataset into the <code>data_load</code> table. However we need to perform a couple of tricks in order to load it properly:</p>
<ul>
<li><code>tr -d &quot;\t&quot; &lt; Users.xml</code> removes the tabs from the file.</li>
<li><code>sed -e ''s/\\/\\\\/g''</code> properly escapes the <code>\</code> in the strings.</li>
<li><code>HEADER</code> avoids to load the initial <code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</code> row, unnecessary for our parsing</li>
</ul>
<h3 id="step-2-load-the-data-into-the-users-table">Step 2: Load the data into the <code>Users</code> table</h3>
<p><img src="/images/2024/stackoverflow-loading-step2.png" alt="Architecture of the data loading phase - step 2"></p>
<p>The above command loads the data into the <code>data_load</code> table with one row in the table for each row in the original file. This is not optimal but avoids having to deal with very large files included in just a single blob.</p>
<p>We can make use the fact that each user is contained in a <code>&lt;raw&gt;</code> tag to leverage PostgreSQL ability to parse XML fields with the following:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>USERS<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Id,<span style="color:#bbb"> </span>CreationDate,<span style="color:#bbb"> </span>DisplayName,<span style="color:#bbb"> </span>LastAccessDate,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Location</span>,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>AboutMe,<span style="color:#bbb"> </span>Views,<span style="color:#bbb"> </span>UpVotes,<span style="color:#bbb"> </span>DownVotes,AccountId,<span style="color:#bbb"> </span>Reputation)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>(xpath(<span style="color:#ba2121">&#39;//@Id&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>id<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@CreationDate&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>CreationDate<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@DisplayName&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>DisplayName<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@LastAccessDate&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>LastAccessDate<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Location&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Location</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@AboutMe&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>AboutMe<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Views&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>Views<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@UpVotes&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>UpVotes<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@DownVotes&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>DownVotes<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@AccountId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>AccountId<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Reputation&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>Reputation<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>data_load,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">unnest</span>(xpath(<span style="color:#ba2121">&#39;//row&#39;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>::xml))<span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>regexp_like(<span style="color:#008000;font-weight:bold">data</span>,<span style="color:#ba2121">&#39;[ ]+\&lt;row&#39;</span>);<span style="color:#bbb">
</span></span></span></code></pre></div><p>The above uses:</p>
<ul>
<li>the <code>xpath</code> to extract the relevant fields from each user</li>
<li>the <code>::text::int</code> to cast the extracted field to the proper column type</li>
<li>the filter <code>regexp_like(data,'[ ]+\&lt;row')</code> to remove the other unnecessary rows, including for example, <code>&lt;users&gt;</code> or <code>&lt;/users&gt;</code></li>
</ul>
<h3 id="load-the-other-tables">Load the other tables</h3>
<p>Similar to the example with <code>Users.xml</code> above, we can load the other tables with the following steps (please not we are truncating the <code>data_load</code> table before loading the next file):</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- Loading posts
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#008000;font-weight:bold">truncate</span><span style="color:#bbb"> </span>data_load;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">\</span><span style="color:#008000;font-weight:bold">copy</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;tr -d &#34;\t&#34; &lt; Posts.xml | sed -e &#39;&#39;s/\\/\\\\/g&#39;&#39;&#39;</span><span style="color:#bbb"> </span>HEADER<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>POSTS<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Id,<span style="color:#bbb"> </span>PostTypeId,<span style="color:#bbb"> </span>CreationDate,<span style="color:#bbb"> </span>score,<span style="color:#bbb"> </span>viewcount,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>body,<span style="color:#bbb"> </span>OwnerUserId,<span style="color:#bbb"> </span>LastActivityDate,<span style="color:#bbb"> </span>Title,<span style="color:#bbb"> </span>Tags,<span style="color:#bbb"> </span>AnswerCount,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>CommentCount,<span style="color:#bbb"> </span>ContentLicense)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>(xpath(<span style="color:#ba2121">&#39;//@Id&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@PostTypeId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@CreationDate&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Score&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@ViewCount&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Body&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@OwnerUserId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@LastActivityDate&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Title&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Tags&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@AnswerCount&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@CommentCount&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@ContentLicense&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>data_load,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">unnest</span>(xpath(<span style="color:#ba2121">&#39;//row&#39;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>::xml))<span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>regexp_like(<span style="color:#008000;font-weight:bold">data</span>,<span style="color:#ba2121">&#39;[ ]+\&lt;row&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-- Loading badges
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">truncate</span><span style="color:#bbb"> </span>data_load;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">\</span><span style="color:#008000;font-weight:bold">copy</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;tr -d &#34;\t&#34; &lt; Badges.xml | sed -e &#39;&#39;s/\\/\\\\/g&#39;&#39;&#39;</span><span style="color:#bbb"> </span>HEADER<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>BADGES<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Id,<span style="color:#bbb"> </span>userId,<span style="color:#bbb"> </span>Name,<span style="color:#bbb"> </span>dt,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">class</span>,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>tagbased)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>(xpath(<span style="color:#ba2121">&#39;//@Id&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@UserId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Name&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Date&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Class&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@TagBased&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">boolean</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>data_load,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">unnest</span>(xpath(<span style="color:#ba2121">&#39;//row&#39;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>::xml))<span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>regexp_like(<span style="color:#008000;font-weight:bold">data</span>,<span style="color:#ba2121">&#39;[ ]+\&lt;row&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-- Loading comments
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">truncate</span><span style="color:#bbb"> </span>data_load;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">\</span><span style="color:#008000;font-weight:bold">copy</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;tr -d &#34;\t&#34; &lt; Comments.xml | sed -e &#39;&#39;s/\\/\\\\/g&#39;&#39;&#39;</span><span style="color:#bbb"> </span>HEADER<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>COMMENTS<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Id,<span style="color:#bbb"> </span>postId,<span style="color:#bbb"> </span>score,<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb"> </span>creationdate,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>userid,<span style="color:#bbb"> </span>contentlicense)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>(xpath(<span style="color:#ba2121">&#39;//@Id&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@PostId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Score&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Text&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@CreationDate&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@UserId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@ContentLicense&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>data_load,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">unnest</span>(xpath(<span style="color:#ba2121">&#39;//row&#39;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>::xml))<span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>regexp_like(<span style="color:#008000;font-weight:bold">data</span>,<span style="color:#ba2121">&#39;[ ]+\&lt;row&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-- Loading posthistory
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">truncate</span><span style="color:#bbb"> </span>data_load;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">\</span><span style="color:#008000;font-weight:bold">copy</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;tr -d &#34;\t&#34; &lt; PostHistory.xml | sed -e &#39;&#39;s/\\/\\\\/g&#39;&#39;&#39;</span><span style="color:#bbb"> </span>HEADER<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>posthistory<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Id,<span style="color:#bbb"> </span>PostHistoryTypeId,<span style="color:#bbb"> </span>postId,<span style="color:#bbb"> </span>RevisionGUID,<span style="color:#bbb"> </span>CreationDate,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>userID,<span style="color:#bbb"> </span><span style="color:#008000">text</span>,<span style="color:#bbb"> </span>ContentLicense)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>(xpath(<span style="color:#ba2121">&#39;//@Id&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@PostHistoryTypeId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@PostId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@RevisionGUID&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@CreationDate&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@UserId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Text&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@ContentLicense&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>data_load,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">unnest</span>(xpath(<span style="color:#ba2121">&#39;//row&#39;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>::xml))<span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>regexp_like(<span style="color:#008000;font-weight:bold">data</span>,<span style="color:#ba2121">&#39;[ ]+\&lt;row&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-- Loading postlinks
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">truncate</span><span style="color:#bbb"> </span>data_load;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">\</span><span style="color:#008000;font-weight:bold">copy</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;tr -d &#34;\t&#34; &lt; PostLinks.xml | sed -e &#39;&#39;s/\\/\\\\/g&#39;&#39;&#39;</span><span style="color:#bbb"> </span>HEADER<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>postlinks<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Id,<span style="color:#bbb"> </span>creationdate,<span style="color:#bbb"> </span>postId,<span style="color:#bbb"> </span>relatedPostId,<span style="color:#bbb"> </span>LinkTypeId)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>(xpath(<span style="color:#ba2121">&#39;//@Id&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@CreationDate&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@PostId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@RelatedPostId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@LinkTypeId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>data_load,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">unnest</span>(xpath(<span style="color:#ba2121">&#39;//row&#39;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>::xml))<span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>regexp_like(<span style="color:#008000;font-weight:bold">data</span>,<span style="color:#ba2121">&#39;[ ]+\&lt;row&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-- Loading tags
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">truncate</span><span style="color:#bbb"> </span>data_load;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">\</span><span style="color:#008000;font-weight:bold">copy</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;tr -d &#34;\t&#34; &lt; Tags.xml | sed -e &#39;&#39;s/\\/\\\\/g&#39;&#39;&#39;</span><span style="color:#bbb"> </span>HEADER<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>tags<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Id,<span style="color:#bbb"> </span>tagname,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">count</span>,<span style="color:#bbb"> </span>ExcerptPostId,<span style="color:#bbb"> </span>WikiPostId,<span style="color:#bbb"> </span>IsModeratorOnly,<span style="color:#bbb"> </span>IsRequired)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>(xpath(<span style="color:#ba2121">&#39;//@Id&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@TagName&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@Count&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@ExcerptPostId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@WikiPostId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@IsModeratorOnly&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">boolean</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@IsRequired&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">boolean</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>data_load,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">unnest</span>(xpath(<span style="color:#ba2121">&#39;//row&#39;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>::xml))<span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>regexp_like(<span style="color:#008000;font-weight:bold">data</span>,<span style="color:#ba2121">&#39;[ ]+\&lt;row&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-- Loading votes
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">truncate</span><span style="color:#bbb"> </span>data_load;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">\</span><span style="color:#008000;font-weight:bold">copy</span><span style="color:#bbb"> </span>data_load<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;tr -d &#34;\t&#34; &lt; Votes.xml | sed -e &#39;&#39;s/\\/\\\\/g&#39;&#39;&#39;</span><span style="color:#bbb"> </span>HEADER<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">INTO</span><span style="color:#bbb"> </span>votes<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Id,<span style="color:#bbb"> </span>postid,<span style="color:#bbb"> </span>votetypeid,<span style="color:#bbb"> </span>creationdate)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>(xpath(<span style="color:#ba2121">&#39;//@Id&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@PostId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@VoteTypeId&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000">int</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>,(xpath(<span style="color:#ba2121">&#39;//@CreationDate&#39;</span>,<span style="color:#bbb"> </span>x))[<span style="color:#666">1</span>]::<span style="color:#008000">text</span>::<span style="color:#008000;font-weight:bold">timestamp</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>data_load,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">unnest</span>(xpath(<span style="color:#ba2121">&#39;//row&#39;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>::xml))<span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>regexp_like(<span style="color:#008000;font-weight:bold">data</span>,<span style="color:#ba2121">&#39;[ ]+\&lt;row&#39;</span>);<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="query-time">Query Time</h2>
<p>Once the data is loaded, we can start querying the dataset. For example, finding the top 2 post having a comment with highest score using the following SQL:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>POSTS.Id,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>POSTS.Title,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>COMMENTS.<span style="color:#008000">Text</span>,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>COMMENTS.SCORE<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>POSTS<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>COMMENTS<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>POSTS.ID<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>COMMENTS.POSTID<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>SCORE<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">DESC</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">LIMIT</span><span style="color:#bbb"> </span><span style="color:#666">2</span>;<span style="color:#bbb">
</span></span></span></code></pre></div><p>Enjoy the dataset and find your own questions and answers!</p>
<p>The following links provide the entire set of <a href="/images/files/2024/stackoverflow/table_create.sql">DDLs</a> and <a href="/images/files/2024/stackoverflow/data_load.sql">Loading</a> SQL!</p>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/ftisiot.jpg" alt="Francesco Tisiot"></p>
<p><a href="https://www.linkedin.com/in/francescotisiot/"><b class="fab fa-linkedin"></b></a> <a href="https://twitter.com/FTisiot"><b class="fab fa-twitter"></b></a><a rel="me" href="https://data-folks.masto.host/@ftisiot">Mastodon</a> Francesco comes from Verona, Italy üáÆüáπ and works as a Staff Developer Advocate at Aiven. With his many years of experience as a data analyst, he has stories to tell and advice for data-wranglers  everywhere. Francesco loves sharing knowledge with others as a speaker and writer, and is on a mission to defend the world from bad Italian food!!</p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://ftisiot.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2024 
			</p>
		</footer>
		
	
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-7Z74BTZ0TM', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
